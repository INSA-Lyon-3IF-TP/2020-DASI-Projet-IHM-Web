<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html style="height: 100%">
    <head>
        <title>Consultation en cours</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body style="height: 100%">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Predict'IF</a>
                <ul class="nav navbar-nav navbar-right">
                  <li class="nav-item ">
                    <a id="terminerConsultation" class="nav-link" href="dashboard.html">Terminer la consultation</a>
                  </li>
                </ul>
            </div>
        </nav>
        <br/>
        <h1 style="text-align: center">Consultation en cours</h1>
        <br/>
        <section style="width:95%; height: 75%; margin: auto; display:flex">
            <div style="width:50%; border: 3px solid black; text-align: center">
                <h2>Demander une prédiction</h2>
                <div style="border-bottom: 3px dotted black; height: 30%; justify-content: center">
                    <div style="height: 70%; display:flex">
                        <div style="margin-top: 5%;width: 30%; text-align: center; justify-content: center" >
                            <label>Note amour : </label>
                            <input type="number" id="amourId" min="1" max="4"/>       
                        </div>
                        <div style="margin-top: 5%;width: 30%; text-align: center; justify-content: center" >
                            <label>Note sante : </label>
                            <input type="number" id="santeId" min="1" max="4"/>    
                        </div>
                        <div style="margin-top: 5%;width: 30%; text-align: center; justify-content: center" >
                            <label>Note travail : </label>
                            <input type="number" id="travailId" min="1" max="4"/>  
                        </div>
                    </div>
                    <div style="height: 30%; text-align: center">
                        <button id="predictions">Valider</button>
                    </div>
                </div>
                <div style="height: 70%">
                    <div style="text-align: center;height: 30%;  display:flex" >
                        <label style="margin-top: 6%;width: 30%">Prédiction amour : </label>
                        <textarea id="predictionAmour" disabled style="margin: 1%;width: 65%"></textarea>       
                    </div>
                    <div style="text-align: center;height: 30%;  display:flex" >
                        <label style="margin-top: 6%;width: 30%">Prédiction sante : </label>
                        <textarea id="predictionSante" disabled style="margin: 1%;width: 65%"></textarea>    
                    </div>
                    <div style="text-align: center;height: 30%;  display:flex" >
                        <label style="margin-top: 6%;width: 30%">Prédiction travail : </label>
                        <textarea id="predictionTravail" disabled style="margin: 1%;width: 65%"></textarea>  
                    </div>
                </div>
            </div>
            <div style="width:50%; border: 3px solid black; text-align: center">
                <h2>Commentaire</h2>
                <textarea id="commentaire" style="width: 90%;height: 90%">
                    
                </textarea>
            </div>
        </section>
    </body>
    <script>
        $(document).ready(function () {
            $.ajax({
                url: 'ActionServlet',
                method: 'GET',
                dataType: 'json',
                data: {'todo': 'getConsultationEnCours'}
            }).done(function (response) {
                if (!response.connexion) {
                    window.location = "loginEmploye.html";
                } else {
                    $('#commentaire').html(response.consultation.commentaire);
                }
            });
            
            $("#predictions").on("click", function() {
                var noteAmour =  $("#amourId").val();
                var noteSante =  $("#santeId").val();
                var noteTravail =  $("#travailId").val();
                console.log(noteAmour);
                console.log(noteSante);
                console.log(noteTravail);
                if(noteAmour <1 || noteAmour > 4 || noteAmour === undefined
                   || noteSante <1 || noteSante > 4 || noteAmour === undefined
                   || noteTravail <1 || noteTravail > 4 || noteAmour === undefined)
                {
                    alert("Notes incorrects");
                    return;
                }
                
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        'todo': 'getPredictions',
                        'noteAmour': noteAmour,
                        'noteSante': noteSante,
                        'noteTravail': noteTravail
                    },
                    dataType: 'json'
                })
                .done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                    console.log('Response',response); // LOG dans Console Javascript
                    if (!response.connexion) {
                        window.location = "loginEmploye.html";
                    }
                    else {
                        $("#predictionAmour").html(response.predictionAmour);
                        $("#predictionSante").html(response.predictionSante);
                        $("#predictionTravail").html(response.predictionTravail);
                    }
                })
                .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                    console.log('Error',error); // LOG dans Console Javascript
                    alert("Erreur lors de l'appel AJAX");
                })
                .always( function () { // Fonction toujours appelée

                });
            });
        });
        
    </script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
</html>
