<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Profil Client</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Predict'IF</a>
                <ul class="nav navbar-nav navbar-right">
                    <li class="nav-item">
                        <a class="nav-link btn" href="indexClient.html">Mediums</a>
                    </li>
                    <li class="nav-item ">
                        <button class="nav-link btn" onclick="disconnect()">Déconnexion</button>
                    </li>
                </ul>
            </div>
        </nav>
        <br/>
        <p>Signe du Zodiac : <span id="zodiaque"></span></p>
        <p>Signe Chinois : <span id="chinois"></span></p>
        <p>Couleur : <span id="couleur"></span></p>
        <p>Animal : <span id="animal"></span></p>
        <br/>
        <button id="historique">Afficher l'historique de mes consultations</button>
        <i id="consultations">

        </i>
        <script>
            function disconnect() {
                $.ajax({
                    url: 'ActionServlet',
                    method: 'get',
                    dataType: 'json',
                    data: {'todo': 'logout'}
                }).done(function (response) {
                    if (!response.success) {
                        alert('Erreur de déconnexion');
                    }
                    window.location = "indexClient.html";
                });
            }

            $(document).ready(function () {

                // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        todo: 'profilClient'
                    },
                    dataType: 'json'
                })
                        .done(function (response) { // Fonction appelée en cas d'appel AJAX réussi
                            console.log('Response', response); // LOG dans Console Javascript
                            if (response.connexion) {
                                $("#zodiaque").html(response.profilAstral.signeZodiaque);
                                $("#chinois").html(response.profilAstral.signeChinois);
                                $("#couleur").html(response.profilAstral.couleur);
                                $("#animal").html(response.profilAstral.animal);
                            } else {
                                window.location.href = "login.html"; //Le client n'est pas connecté
                            }
                        })
                        .fail(function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                            console.log('Error', error); // LOG dans Console Javascript
                            alert("Erreur lors de l'appel AJAX");
                        })
                        .always(function () { // Fonction toujours appelée

                        });
            });




            $("#historique").on("click", function () {
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    dataType: 'json',
                    data: {'todo': 'historiqueConsultationClient'}
                }).done(function (response) {
                    $('#consultations').empty();
                    console.log(response);
                    $('#consultations').append(
                            $('<div />')
                            .attr('id', 'historique')
                            .attr('style', 'width: 90%')
                            .append(
                                    $('<table />')
                                    .attr('id', 'consultationsTable')
                                    .addClass('table')
                                    .append(
                                            $('<thead />')
                                            .append(
                                                    $('<tr />')
                                                    .attr('id', 'table_head')
                                                    .append(
                                                            $('<th />')
                                                            .attr('scope', 'col')
                                                            .html('Medium'),
                                                            $('<th />')
                                                            .attr('scope', 'col')
                                                            .html('Type'),
                                                            $('<th />')
                                                            .attr('scope', 'col')
                                                            .html('Heure de demande'),
                                                            $('<th />')
                                                            .attr('scope', 'col')
                                                            .html('Heure de début'),
                                                            $('<th />')
                                                            .attr('scope', 'col')
                                                            .html('Heure de fin'),
                                                            )
                                                    )
                                            )
                                    )
                            );
                    if (response.connexion) {
                        if (typeof response.consultations === 'undefined' || response.consultations.length < 1)
                        {
                            return;
                        } else {
                            response.consultations.forEach(function (consultation) {
                                let medium = $('<td />').html(consultation.mediumDenomination);
                                let type = $('<td />').html(consultation.mediumType);
                                let heureDemande = $('<td />').html(consultation.heureDemande);
                                let heureDebut = $('<td />').html(consultation.heureDebut);
                                let heureFin = $('<td />').html(consultation.heureFin);
                                $('#consultationsTable')
                                        .append(
                                                $('<tr>')
                                                .append(
                                                        medium,
                                                        type,
                                                        heureDemande,
                                                        heureDebut,
                                                        heureFin
                                                        )
                                                );
                            });
                        }
                    } else {
                        window.location.href = "login.html";
                    }

                });
            });

        </script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://unpkg.com/@popperjs/core@2"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    </body>
</html>
